<div class="listado-container">
  <h2>Consulta de Usuarios</h2>

  <form (ngSubmit)="buscar()">
    <select [(ngModel)]="tipoBusqueda" name="tipoBusqueda" (change)="limpiarTerminoBusqueda()">
      <option value="documento_identidad">Buscar por Documento de identidad</option>
      <option value="nombre">Buscar por Nombre</option>
      <option value="email">Buscar por Email</option>
    </select>
    
    <input 
      type="text" 
      [(ngModel)]="terminoBusqueda" 
      name="terminoBusqueda" 
      placeholder="Introduce el término de búsqueda..."
      [attr.aria-label]="'Buscar por ' + tipoBusqueda"
    >
    
    <button type="submit">Buscar</button>
    <button type="button" (click)="limpiarResultados()">Limpiar</button>
  </form>

  <div *ngIf="mensajeError" class="error-message">
    {{ mensajeError }}
  </div>

  <div *ngIf="mensajeExito" class="success-message">
    {{ mensajeExito }}
  </div>

  <div *ngIf="buscando" class="loading">
    Buscando usuarios...
  </div>

  <div *ngIf="usuarios.length > 0" class="results-container">
    <h3>Resultados ({{ usuarios.length }} encontrados)</h3>
    
    <table>
      <thead>
        <tr>
          <th>Foto</th>
          <th>Nombre</th>
          <th>Email</th>
          <th>Documento de identidad</th>
          <th>Fecha de Nacimiento</th>
          <th>Acciones</th> <!-- nueva columna para acciones -->
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let usuario of usuarios">
          <td>
            <img 
              [src]="usuario.foto && usuario.foto !== '' ? usuario.foto : '/ic_no_foto.png'" 
              alt="Foto del usuario" 
              class="foto-usuario"
            />
          </td>
          <td>
            <input 
              type="text" 
              [(ngModel)]="usuario.nombre" 
              placeholder="Editar nombre"
              (focus)="almacenarDatosOriginales(usuario)"
            />
          </td>
          <td>
            <input 
              type="email" 
              [(ngModel)]="usuario.email" 
              placeholder="Editar email"
              (focus)="almacenarDatosOriginales(usuario)"
            />
          </td>
          <td>
            <input 
              type="text" 
              [(ngModel)]="usuario.documento_identidad" 
              placeholder="Editar documento"
              (focus)="almacenarDatosOriginales(usuario)"
            />
          </td>
          <td>
            <input 
              type="date" 
              [(ngModel)]="usuario.fecha_nacimiento" 
              (focus)="almacenarDatosOriginales(usuario)"
              placeholder="Editar fecha de nacimiento"
            />
          </td>
          <td data-label="Acciones">
            <button (click)="iniciarActualizacionUsuario(usuario)">Actualizar</button>
            <button (click)="eliminarUsuario(usuario.documento_identidad)" class="btn-danger">Eliminar Usuario</button>
            <button (click)="eliminarFotoUsuario(usuario.documento_identidad)" class="btn-warning">Eliminar Foto</button>
          </td>
        </tr>
      </tbody>
    </table>

    <!-- Controles de paginación -->
    <div class="pagination-controls">
      <button (click)="cambiarPagina(-1)" [disabled]="skip === 0">Anterior</button>
      <span>Página {{ (skip / limit) + 1 }} de {{ getTotalPaginas() }}</span>
      <button (click)="cambiarPagina(1)" [disabled]="skip + limit >= totalUsuarios">Siguiente</button>
    </div>
  </div>
</div>